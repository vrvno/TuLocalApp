(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{776:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n(0),a=n(28),i=n(29),s=(n(7),n(24),n(36),n(421),n(48),n(110),n(19),n(38),n(20),n(25),n(31),n(49),n(53),n(22),n(15),n(2)),o=n(4),u=n(54);function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=function(){function e(t,n,r,i,s,o){Object(a.a)(this,e),this.id=void 0,this.w=void 0,this.h=void 0,this.stage=void 0,this.queue=void 0,this.maxConnection=void 0,this.config=void 0,this.commonImages=void 0,this.memberImages=void 0,this.scales=void 0,this.cbQueueLoadProgress=void 0,this.cbQueueLoadComplete=void 0,this.rule=void 0,this._loading=!1,this.baseStage=void 0,this.id=t,this.w=n.w,this.h=n.h,this.maxConnection=10,this.config=n,this.commonImages=r,this.memberImages=i,this.scales=s,this.rule=o,this.cbQueueLoadComplete=function(){},this.queue=this._queueFactory(),this.stage=this._stageFactory(n)}var t,n,l,f,h,g,v;return Object(i.a)(e,[{key:"setMaxConnection",value:function(e){this.maxConnection=e,this.queue&&this.queue.setMaxConnections(e)}},{key:"isLoadingImage",value:function(){return this._loading}},{key:"_setManifest",value:function(e,t,n,r,a){if(r||a){var i=n>0,s={src:i?a:r,id:t,name:t,is2x:i,x1Url:r,x2Url:a};e.push(s)}}},{key:"_getPartsManifests",value:(v=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,c,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,s.a.localData.getParts(t.pId);case 3:if(r=e.sent)for(a=0;a<t.lyrs.length;a++){if(i=t.lyrs[a],o=null,c=this.commonImages[r.itmId]||this.memberImages[r.itmId])try{o=c[i][r.cId]}catch(e){}o?(l=u.a.imageUrl(o.url),f=o.x2Url?u.a.imageUrl(o.x2Url):"",this._setManifest(n,i,r.sNo,l,f)):null==(h=this.stage.findOne("."+i))||h.visible(!1)}return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"loadInitialImages",value:(g=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=0;case 2:if(!(n<this.config.pList.length)){e.next=13;break}return r=this.config.pList[n],e.t0=Array.prototype.push,e.t1=t,e.next=8,this._getPartsManifests(r);case 8:e.t2=e.sent,e.t0.apply.call(e.t0,e.t1,e.t2);case 10:n++,e.next=2;break;case 13:t.length>0?this.queue.loadManifest(t):this.stage.getStage().draw();case 14:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"loadSettings",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.localData.getAll();case 2:if(t=e.sent)for(n=0;n<this.config.pList.length;n++)r=this.config.pList[n],a=t[r.pId],this.rotateAction(r,a),this.scalingAction(r,a),this.moveAction(r,a);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"_queueFactory",value:function(){var e=this,t=new s.a.PreloadImage(this.maxConnection);t.addEventListener("progress",(function(t){return e.onProgress(t,e)})),t.addEventListener("fileLoad",(function(t){return e.onFileLoad(t,e)})),t.addEventListener("complete",function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onComplete(n,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.addEventListener("error",(function(e){})),t.addEventListener("fileError",(function(e){}));var n=this;return{setMaxConnections:t.setMaxConnections,loadManifest:function(e){return Object(r.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n._loading=!0,r.next=3,t.load(e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})))()}}}},{key:"_stageFactory",value:function(e){s.a.Konva.autoDrawEnabled=!1,s.a.Konva.pixelRatio=1;var t=this.baseStage=new s.a.Konva.Stage({container:this.id,width:this.w,height:this.h}),n=new s.a.Konva.Layer;return t.add(n),Object.keys(e.lyrList).forEach((function(e){var t=new s.a.Konva.Image({x:0,y:0,id:e,name:e});n.add(t)})),Object.entries(e.lyrList).slice().sort((function(e,t){return e[1]-t[1]})).forEach((function(e,t){n.findOne("."+e[0]).zIndex(t)})),n}},{key:"setCallbackQueueLoadProgress",value:function(e){this.cbQueueLoadProgress=e}},{key:"setCallbackQueueLoadComplete",value:function(e){this.cbQueueLoadComplete=e}},{key:"onProgress",value:function(e,t){"function"==typeof t.cbQueueLoadProgress&&t.cbQueueLoadProgress(e.progress)}},{key:"onFileLoad",value:function(e,t){var n=t.stage.findOne("."+e.item.name);n.image(e.result),n.visible(!0),n.is2x=e.item.is2x,n.x1Url=e.item.x1Url,n.x2Url=e.item.x2Url}},{key:"onComplete",value:(f=Object(r.a)(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.loadSettings();case 2:n.stage.getStage().draw(),n._loading=!1,n.cbQueueLoadComplete();case 5:case"end":return e.stop()}}),e)}))),function(e,t){return f.apply(this,arguments)})},{key:"onItemChange",value:(l=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=c(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return i=a.value,e.t0=Array.prototype.push,e.t1=n,e.next=10,this._getPartsManifests(i);case 10:e.t2=e.sent,e.t0.apply.call(e.t0,e.t1,e.t2);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t3=e.catch(2),r.e(e.t3);case 19:return e.prev=19,r.f(),e.finish(19);case 22:n.length>0?this.queue.loadManifest(n):this.stage.getStage().draw();case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return l.apply(this,arguments)})},{key:"onColorChange",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0;case 2:if(!(r<t.length)){e.next=14;break}return a=t[r],i=this.config.pList[a],e.t0=Array.prototype.push,e.t1=n,e.next=9,this._getPartsManifests(i);case 9:e.t2=e.sent,e.t0.apply.call(e.t0,e.t1,e.t2);case 11:r++,e.next=2;break;case 14:n.length>0?this.queue.loadManifest(n):this.stage.getStage().draw();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onPartsControl",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.localData.getParts(n.pId);case 2:if(r=e.sent,a=!1,!r){e.next=21;break}e.t0=t.category,e.next=e.t0===o.CATEGORY.MOVE||e.t0===o.CATEGORY.SPACE?8:e.t0===o.CATEGORY.SCALING?10:e.t0===o.CATEGORY.ROTATE?13:e.t0===o.CATEGORY.RESET?16:20;break;case 8:return a=this.moveAction(n,r),e.abrupt("break",20);case 10:return a=this.scalingAction(n,r),a&=this.moveAction(n,r),e.abrupt("break",20);case 13:return a=this.rotateAction(n,r),a&=this.moveAction(n,r),e.abrupt("break",20);case 16:return a=this.scalingAction(n,r),a&=this.rotateAction(n,r),a&=this.moveAction(n,r),e.abrupt("break",20);case 20:a&&this.stage.getStage().draw();case 21:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"moveAction",value:function(e,t){var n=e.ticX?e.ticX:0,r=e.ticY?e.ticY:0,a=e.ticWSp?e.ticWSp:0;if(e.pType==o.PARTS_TYPE.PAIR){var i=a*t.spCnt,s=this.stage.findOne("."+e.lyrL);if(s.visible()){var u=s.is2x?.5:1;s.x(u*s.offsetX()+e.x+t.xCnt*n+i),s.y(u*s.offsetY()+e.y+t.yCnt*r)}var c=-1*i,l=this.stage.findOne("."+e.lyrR);if(l.visible()){var f=l.is2x?.5:1;l.x(f*l.offsetX()+e.rpX+t.xCnt*n+c),l.y(f*l.offsetY()+e.y+t.yCnt*r)}}else for(var h=0;h<e.lyrs.length;h++){var g=e.lyrs[h],v=this.stage.findOne("."+g);if(v.visible()){var p=v.is2x?.5:1;v.x(p*v.offsetX()+e.x+t.xCnt*n),v.y(p*v.offsetY()+e.y+t.yCnt*r)}}return!0}},{key:"scalingAction",value:function(e,t){for(var n=[],r=0;r<e.lyrs.length;r++){var a=e.lyrs[r],i=this.stage.findOne("."+a);if(i.visible())if(i.is2x&&t.sNo<=0||!i.is2x&&t.sNo>0)this._setManifest(n,a,t.sNo,i.x1Url,i.x2Url);else{var s=parseFloat(this.scales[t.sNo]);i.offsetX(i.width()/2),i.offsetY(i.height()/2),i.scaleX(s),i.scaleY(s)}}return!(n.length>0)||(this.queue.loadManifest(n),!1)}},{key:"rotateAction",value:function(e,t){var n=e.ticRota?e.ticRota:0;if(e.pType==o.PARTS_TYPE.PAIR){var r=e.angle+n*t.rotaCnt;this._rotate(e.lyrL,r);var a=e.angle-n*t.rotaCnt;this._rotate(e.lyrR,a)}else for(var i=0;i<e.lyrs.length;i++){var s=e.lyrs[i],u=e.angle+n*t.rotaCnt;this._rotate(s,u)}return!0}},{key:"_rotate",value:function(e,t){var n=this.stage.findOne("."+e);n.visible()&&(n.offsetX(n.width()/2),n.offsetY(n.height()/2),n.rotation(t))}},{key:"getBlob",value:function(){return s.a.dataURLtoBlob(this.toDataURL())}},{key:"toDataURL",value:function(){return this.stage.getStage().toDataURL()}},{key:"getImage",value:function(){var e=new Image;return e.src=this.toDataURL(),e}},{key:"destroy",value:function(){this.baseStage.destroy()}}]),e}()}}]);